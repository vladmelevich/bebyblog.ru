{"ast":null,"code":"// Утилиты для работы с авторизацией\n\n// Получить токен из хранилища\nexport const getToken = () => {\n  return localStorage.getItem('accessToken') || sessionStorage.getItem('accessToken');\n};\n\n// Получить refresh токен из хранилища\nexport const getRefreshToken = () => {\n  return localStorage.getItem('refreshToken') || sessionStorage.getItem('refreshToken');\n};\n\n// Сохранить токены\nexport const saveTokens = (accessToken, refreshToken, rememberMe = false) => {\n  if (rememberMe) {\n    localStorage.setItem('accessToken', accessToken);\n    localStorage.setItem('refreshToken', refreshToken);\n  } else {\n    sessionStorage.setItem('accessToken', accessToken);\n    sessionStorage.setItem('refreshToken', refreshToken);\n  }\n};\n\n// Удалить токены\nexport const removeTokens = () => {\n  localStorage.removeItem('accessToken');\n  localStorage.removeItem('refreshToken');\n  sessionStorage.removeItem('accessToken');\n  sessionStorage.removeItem('refreshToken');\n};\n\n// Обновить токен\nexport const refreshAccessToken = async () => {\n  const refreshToken = getRefreshToken();\n  if (!refreshToken) {\n    throw new Error('Нет refresh токена');\n  }\n  try {\n    const response = await fetch('http://localhost:8000/api/auth/token/refresh/', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        refresh: refreshToken\n      })\n    });\n    if (response.ok) {\n      const data = await response.json();\n\n      // Сохраняем новый токен в том же хранилище, где был старый\n      const storage = localStorage.getItem('accessToken') ? localStorage : sessionStorage;\n      storage.setItem('accessToken', data.access);\n      return data.access;\n    } else {\n      throw new Error('Не удалось обновить токен');\n    }\n  } catch (error) {\n    console.error('Ошибка обновления токена:', error);\n    removeTokens();\n    throw error;\n  }\n};\n\n// Проверить, авторизован ли пользователь\nexport const isAuthenticated = () => {\n  return !!getToken();\n};\n\n// Получить данные пользователя\nexport const getUserData = () => {\n  const userData = localStorage.getItem('userData');\n  return userData ? JSON.parse(userData) : null;\n};\n\n// Автоматическая проверка токена при загрузке\nexport const checkAuthOnLoad = async () => {\n  const token = getToken();\n  if (!token) {\n    return false;\n  }\n  try {\n    const response = await fetch('http://localhost:8000/api/auth/me/', {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    if (response.ok) {\n      return true;\n    } else if (response.status === 401) {\n      // Токен истек, пробуем обновить\n      try {\n        await refreshAccessToken();\n        return true;\n      } catch (error) {\n        removeTokens();\n        return false;\n      }\n    } else {\n      return false;\n    }\n  } catch (error) {\n    console.error('Ошибка проверки авторизации:', error);\n    return false;\n  }\n};","map":{"version":3,"names":["getToken","localStorage","getItem","sessionStorage","getRefreshToken","saveTokens","accessToken","refreshToken","rememberMe","setItem","removeTokens","removeItem","refreshAccessToken","Error","response","fetch","method","headers","body","JSON","stringify","refresh","ok","data","json","storage","access","error","console","isAuthenticated","getUserData","userData","parse","checkAuthOnLoad","token","status"],"sources":["C:/Users/Wlad/OneDrive/Desktop/kwork_site/src/utils/auth.js"],"sourcesContent":["// Утилиты для работы с авторизацией\r\n\r\n// Получить токен из хранилища\r\nexport const getToken = () => {\r\n  return localStorage.getItem('accessToken') || sessionStorage.getItem('accessToken');\r\n};\r\n\r\n// Получить refresh токен из хранилища\r\nexport const getRefreshToken = () => {\r\n  return localStorage.getItem('refreshToken') || sessionStorage.getItem('refreshToken');\r\n};\r\n\r\n// Сохранить токены\r\nexport const saveTokens = (accessToken, refreshToken, rememberMe = false) => {\r\n  if (rememberMe) {\r\n    localStorage.setItem('accessToken', accessToken);\r\n    localStorage.setItem('refreshToken', refreshToken);\r\n  } else {\r\n    sessionStorage.setItem('accessToken', accessToken);\r\n    sessionStorage.setItem('refreshToken', refreshToken);\r\n  }\r\n};\r\n\r\n// Удалить токены\r\nexport const removeTokens = () => {\r\n  localStorage.removeItem('accessToken');\r\n  localStorage.removeItem('refreshToken');\r\n  sessionStorage.removeItem('accessToken');\r\n  sessionStorage.removeItem('refreshToken');\r\n};\r\n\r\n// Обновить токен\r\nexport const refreshAccessToken = async () => {\r\n  const refreshToken = getRefreshToken();\r\n  \r\n  if (!refreshToken) {\r\n    throw new Error('Нет refresh токена');\r\n  }\r\n\r\n  try {\r\n    const response = await fetch('http://localhost:8000/api/auth/token/refresh/', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        refresh: refreshToken\r\n      })\r\n    });\r\n\r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      \r\n      // Сохраняем новый токен в том же хранилище, где был старый\r\n      const storage = localStorage.getItem('accessToken') ? localStorage : sessionStorage;\r\n      storage.setItem('accessToken', data.access);\r\n      \r\n      return data.access;\r\n    } else {\r\n      throw new Error('Не удалось обновить токен');\r\n    }\r\n  } catch (error) {\r\n    console.error('Ошибка обновления токена:', error);\r\n    removeTokens();\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Проверить, авторизован ли пользователь\r\nexport const isAuthenticated = () => {\r\n  return !!getToken();\r\n};\r\n\r\n// Получить данные пользователя\r\nexport const getUserData = () => {\r\n  const userData = localStorage.getItem('userData');\r\n  return userData ? JSON.parse(userData) : null;\r\n};\r\n\r\n// Автоматическая проверка токена при загрузке\r\nexport const checkAuthOnLoad = async () => {\r\n  const token = getToken();\r\n  \r\n  if (!token) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch('http://localhost:8000/api/auth/me/', {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      }\r\n    });\r\n\r\n    if (response.ok) {\r\n      return true;\r\n    } else if (response.status === 401) {\r\n      // Токен истек, пробуем обновить\r\n      try {\r\n        await refreshAccessToken();\r\n        return true;\r\n      } catch (error) {\r\n        removeTokens();\r\n        return false;\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (error) {\r\n    console.error('Ошибка проверки авторизации:', error);\r\n    return false;\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}